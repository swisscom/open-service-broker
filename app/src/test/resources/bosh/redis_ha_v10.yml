director_uuid: BOSH_UID #STACK LEVEL
name: {{prefix}}-{{guid}} #SERVICE-INSTANCE LEVEL  e.g. <serviceid>
instance_groups:
- azs:
  - z1
  instances: 3
  jobs:
  - name: redis
    properties:
      redis-server:
        databases: {{databases}} #SERVICE-INSTANCE LEVEL
        instances: 3
        master-name: {{guid}} #SERVICE-INSTANCE LEVEL
        maxclients: {{maxclients}} #SERVICE-INSTANCE LEVEL
        port: {{redis-server-port}} #SERVICE-INSTANCE LEVEL
        security:
          require_pass: {{password}} #SERVICE-TEMPLATE LEVEL
        sentinel-port: {{redis-sentinel-port}} #SERVICE-INSTANCE LEVEL
        service-name: {{guid}} #SERVICE-INSTANCE LEVEL
        timeout: 10
        config-command: {{config-command}} #SERVICE-INSTANCE LEVEL
        slaveof-command: {{slaveof-command}} #SERVICE-INSTANCE LEVEL

    release: redis-ha
  - name: redis-sentinel
    properties:
      redis-sentinel:
        announce-port: {{redis-sentinel-port}} #SERVICE-INSTANCE LEVEL
        auth-pass: {{password}} #SERVICE-TEMPLATE LEVEL
        down-after-millisecond: 5000
        failover-timeout: 20000
        master-name: {{guid}} #SERVICE-INSTANCE LEVEL
        master-port: {{redis-server-port}} #SERVICE-INSTANCE LEVEL
        parallel-syncs: 1
        port: {{redis-sentinel-port}} #SERVICE-INSTANCE LEVEL
        quorum: 2
        service-name: {{guid}} #SERVICE-INSTANCE LEVEL
        config-command: {{config-command}} #SERVICE-INSTANCE LEVEL
        slaveof-command: {{slaveof-command}} #SERVICE-INSTANCE LEVEL
    release: redis-ha
  - name: consul
    properties:
      consul:
        acl_datacenter:  #STACK LEVEL
        acl_token:       #STACK LEVEL
        datacenter:      #STACK LEVEL
        encrypt:         #STACK LEVEL
        join_hosts:
        - 10.0.22.50     #STACK LEVEL
        - 10.0.22.51     #STACK LEVEL
        - 10.0.22.52     #STACK LEVEL
        server: false
    release: konsul
  migrated_from:
  - az: z1
    name: redis-ha_{{guid}}_z1 #SERVICE-INSTANCE LEVEL
  name: redis-ha_{{guid}} #SERVICE-INSTANCE LEVEL
  networks:
  - default:
    - dns
    - gateway
    name: #STACK LEVEL
  persistent_disk_type: {{plan}} #SERVICE-INSTANCE LEVEL
  stemcell: bosh-openstack-kvm-ubuntu-trusty-go_agent
  vm_type: {{guid}} #SERVICE-INSTANCE LEVEL
properties: {}
releases:
- name: redis-ha
  version: {{release-version}} #SERVICE-TEMPLATE LEVEL
- name: konsul
  version: {{konsul-version}}  #SERVICE_TEMPLATE LEVEL
stemcells:
- alias: bosh-openstack-kvm-ubuntu-trusty-go_agent
  name: bosh-openstack-kvm-ubuntu-trusty-go_agent
  version: {{stemcell-version}} #SERVICE-TEMPLATE LEVEL
update:
  canaries: 1
  canary_watch_time: 30000-180000
  max_in_flight: 1
  serial: true
  update_watch_time: 30000-180000